<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batalha Naval</title>
    <!-- Estilos CSS -->
    <link rel="stylesheet" href="./frontend/css/styles.css">
    <!-- Adicionando o script da biblioteca MQTT.js via CDN -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>

<body>
    <h1>Batalha Naval</h1>
    <!-- Botão para enviar um movimento -->
    <button id="sendMove">Enviar Movimento</button>

    <div class="input-container">
        <input type="text" id="messageInput" placeholder="Digite sua mensagem">
        <button id="sendButton" onclick="sendMessage()">Enviar</button>
    </div>

    <!-- O seu script com a lógica do jogo -->
    <!--<script type="module" src="./backend/server.js"></script> -->


    <script type="module">
        import { InicializaConexaoMQTT, ProcurarJogo, PublicarMensagem, SairDoJogo } from './backend/server.js';

        // Inicializa a conexão com o servidor MQTT
        InicializaConexaoMQTT();

        // Procura um jogo disponível
        //function ProcurarJogo(gameId, playerName, goToGameBoardCallback)
        ProcurarJogo("teste", `Rodrigo_${Math.random().toString(5)}`, () => {
            console.log('Jogo encontrado!');
        });

        export function sendMessage() {
            // Função será definida posteriormente
            const message = document.getElementById('messageInput').value;
            console.log('Mensagem:', message);
            // Enviar a mensagem para o servidor MQTT da funçao contina no arquivo server.js
            //PublicarMensagem(topic, message)
            PublicarMensagem('chat', message);

        }

        export function printGameBoard() {
            // Função será definida posteriormente
            console.log('Imprimir tabuleiro do jogo');

        }

        // Attach sendMessage to the window object
        window.sendMessage = sendMessage;

        document.addEventListener('DOMContentLoaded', () => {
            window.addEventListener('beforeunload', (event) => { // Perform any cleanup or save state here 
                console.log('User is about to close the tab or browser');
                PublicarMensagem('chat', 'Saindo do jogo...'); SairDoJogo();
                // Optionally, show a confirmation dialog 
                // event.preventDefault(); 
                // event.returnValue = 'are you sure you want to leave?'; 
            });
        });
    </script>
</body>